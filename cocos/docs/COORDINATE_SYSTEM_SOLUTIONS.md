# Canvas 中心原点坐标系统适配方案

## 问题说明
Cocos Creator 的 Canvas 节点默认使用**中心原点坐标系统**：
- 中心点 (0, 0) 在画布中央
- X 轴：[-800, +800] (设计分辨率 1600)
- Y 轴：[-320, +320] (设计分辨率 640)

而游戏代码可能假设使用**左下角原点坐标系统**：
- 左下角 (0, 0)
- X 轴：[0, 1600]
- Y 轴：[0, 640]

## 解决方案对比

### 方案 1：调整节点的锚点和位置 ✅ **推荐（已实现）**

**原理：**
通过设置子节点的 UITransform，让节点的锚点在左下角，然后将节点位置偏移到画布的左下角。

**优点：**
- ✅ 不需要修改任何游戏逻辑代码
- ✅ 子节点可以继续使用 (0,0) 到 (width, height) 的坐标系统
- ✅ 实现简单，只需在初始化时设置一次
- ✅ 所有现有代码无需改动

**实现代码：**
```typescript
const uiTransform = node.getComponent(UITransform);
if (uiTransform) {
    uiTransform.setAnchorPoint(0, 0);  // 锚点设置为左下角
    node.setPosition(
        -GameConfig.DESIGN_WIDTH / 2,   // X 偏移到左边界
        -GameConfig.DESIGN_HEIGHT / 2,  // Y 偏移到下边界
        0
    );
    uiTransform.setContentSize(GameConfig.DESIGN_WIDTH, GameConfig.DESIGN_HEIGHT);
}
```

**已适配的节点：**
- `Background` 节点（用于网格绘制）
- `World` 节点（用于游戏对象：武器、敌人等）
- `UI` 节点保持中心原点（UI 元素通常使用中心原点更方便）

---

### 方案 2：创建坐标转换工具类

**原理：**
创建一个 `CoordinateHelper` 类，封装所有坐标转换逻辑。

**优点：**
- ✅ 统一管理坐标转换
- ✅ 代码复用性好
- ✅ 容易维护和调试

**缺点：**
- ❌ 需要修改所有使用坐标的地方
- ❌ 代码侵入性强
- ❌ 增加了代码复杂度

**适用场景：**
如果游戏已经完成开发，需要全面控制坐标系统时使用。

---

### 方案 3：修改所有坐标计算代码

**原理：**
直接在每个使用坐标的地方加上偏移量。

**优点：**
- ✅ 不依赖额外的工具类
- ✅ 每个地方都清楚地显示坐标转换

**缺点：**
- ❌ 需要修改大量代码
- ❌ 容易遗漏某些地方
- ❌ 维护困难
- ❌ 代码重复多

**不推荐使用。**

---

### 方案 4：在编辑器中手动设置

**原理：**
直接在 Cocos Creator 编辑器的属性检查器中设置每个节点的锚点和位置。

**优点：**
- ✅ 可视化设置
- ✅ 不需要写代码

**缺点：**
- ❌ 每次创建新场景都需要重新设置
- ❌ 容易忘记设置
- ❌ 不利于团队协作

**适用场景：**
原型开发或单场景小游戏。

---

## 推荐实践

1. **使用方案 1**（已实现）：在游戏初始化时通过代码设置节点的锚点和位置
2. **分层处理**：
   - `World` 层（游戏对象）：使用左下角原点，方便网格计算
   - `UI` 层：使用中心原点，方便界面布局
3. **在编辑器中确认**：设置完成后，在编辑器中检查节点的锚点和位置是否正确

## 验证方法

运行游戏后检查：
- ✅ 网格是否正确显示在画布上
- ✅ 敌人是否从左侧生成
- ✅ 武器是否正确放置在网格中
- ✅ UI 元素是否正确显示

## 常见问题

**Q: 为什么 UI 节点不设置锚点？**
A: UI 元素通常使用中心原点更方便布局（如居中显示）。World 层需要网格计算所以用左下角原点。

**Q: 如果后续添加新节点怎么办？**
A: 在 `World` 下的游戏对象会自动继承父节点的坐标系统，使用相对坐标即可。

**Q: 相机需要调整吗？**
A: 通常不需要，相机渲染的是世界坐标系统，节点设置好后会自动正确显示。
